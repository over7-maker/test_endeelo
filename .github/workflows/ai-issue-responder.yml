name: "AI Issue Auto-Responder"

on:
  issues:
    types: [opened, reopened, edited]
  issue_comment:
    types: [created]
  workflow_dispatch:

permissions:
  issues: write
  contents: read

env:
  PYTHON_VERSION: '3.11'

jobs:
  respond:
    runs-on: ubuntu-latest
    if: github.event_name == 'issues' || github.event_name == 'workflow_dispatch' || (github.event_name == 'issue_comment' && contains(github.event.comment.body, '@ai'))
    
    steps:
      - name: "ðŸ“¥ Checkout Repository"
        uses: actions/checkout@v4
      
      - name: "ðŸ Setup Python"
        uses: actions/setup-python@v5
        with:
          python-version: ${{ env.PYTHON_VERSION }}
          cache: 'pip'
      
      - name: "ðŸ“¦ Install Dependencies"
        run: |
          pip install --upgrade pip
          pip install -r requirements.txt
      
      - name: "ðŸ“ Get Issue Context"
        id: context
        run: |
          ISSUE_NUMBER="${{ github.event.issue.number || '6' }}"
          TITLE="${{ github.event.issue.title }}"
          BODY="${{ github.event.issue.body }}"
          COMMENT="${{ github.event.comment.body }}"
          
          echo "issue_number=$ISSUE_NUMBER" >> $GITHUB_OUTPUT
          echo "title=$TITLE" >> $GITHUB_OUTPUT
          
          # Create context file for AI
          cat > issue_context.txt <<EOF
          Issue Title: $TITLE
          
          Issue Body:
          $BODY
          
          Latest Comment:
          $COMMENT
          EOF
          
          cat issue_context.txt

      - name: "ðŸ¤– Run AI Issue Responder"
        run: python3 .github/scripts/run_issue_responder.py
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
          ISSUE_NUMBER: ${{ github.event.issue.number }};
            
            console.log(`âœ… Added 'ai-responded' label to issue #${issueNumber}`);
